<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.sbs.dagachi.repository.ReservationRepository">

<select id="getForPrintReservations" resultType="Reservation">
    SELECT R.*,
    M.MEMBER_ID AS RESERVATION_MEMBER
    FROM RESERVATION AS R
    LEFT JOIN MEMBER AS M
    ON R.RESERVATION_MEMBER = M.MEMBER_ID
    <if test="searchKeyword != ''">
        WHERE (
            <choose>
                <when test="searchKeywordTypeCode == 'reservation_member'">
                    R.RESERVATION_MEMBER LIKE CONCAT('%', #{searchKeyword}, '%')
                </when>
                <when test="searchKeywordTypeCode == 'room_code'">
                    R.ROOM_CODE LIKE CONCAT('%', #{searchKeyword}, '%')
                </when>
                <otherwise>
                    R.RESERVATION_MEMBER LIKE CONCAT('%', #{searchKeyword}, '%') OR R.ROOM_CODE LIKE CONCAT('%', #{searchKeyword}, '%')
                </otherwise>
            </choose>
        )
    </if>
    ORDER BY R.RESERVATION_REGTIME DESC
    <if test="limitTake != -1">
        LIMIT #{limitStart}, #{limitTake}
    </if>
</select>



<select id="getReservationCount" resultType="int">
    SELECT COUNT(*) AS cnt
    FROM RESERVATION AS R
    <if test="searchKeyword != ''">
        WHERE (
            <choose>
                <when test="searchKeywordTypeCode == 'reservation_member'">
                    R.RESERVATION_MEMBER LIKE CONCAT('%', #{searchKeyword}, '%')
                </when>
                <when test="searchKeywordTypeCode == 'room_code'">
                    R.ROOM_CODE LIKE CONCAT('%', #{searchKeyword}, '%')
                </when>
                <otherwise>
                    R.RESERVATION_MEMBER LIKE CONCAT('%', #{searchKeyword}, '%') OR R.ROOM_CODE LIKE CONCAT('%', #{searchKeyword}, '%')
                </otherwise>
            </choose>
        )
    </if>
</select>


	
</mapper> 